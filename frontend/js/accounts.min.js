null==localStorage.getItem("sessionToken")&&location.replace("/");const BASE_HOST_ACCOUNTS=location.protocol+"//"+location.host,HOST=BASE_HOST_ACCOUNTS.replace(":8080",":8000");async function gatherData(e,t,o={}){try{const o=await fetch(e,{headers:{Authorization:`Token ${t}`}});if(o.ok){const t=await o.json();if(e.includes("get_accounts")){let e="";for(let o=0;o<t.length;o++)e+=`<div class="list_item_acc" data-id="${t[o].id}">\n                    <div class="name_row d-flex">\n                        <div class="static_signature">Имя: </div>\n                        <div class="item_name ml-1">${t[o].account_name}</div>\n                    </div>\n                   \n                    <input class="form_control_item_editing d-none" value="${t[o].account_name}">\n                    <div class="item_control_container">\n                        <div class="item_delete item_control"></div>\n                        <div class="item_edit item_control"></div>\n                        <div class="done_item_sign d-none"></div>\n                    </div>\n                </div>`;document.querySelector(".accounts_list").innerHTML=e}}else 401===o.status?(""===localStorage.getItem("sessionToken")&&null===localStorage.getItem("sessionToken")&&void 0===localStorage.getItem("sessionToken")||(localStorage.removeItem("sessionToken"),location.replace("/")),location.replace("/")):(console.log("Error:",o.statusText),""===localStorage.getItem("sessionToken")&&null===localStorage.getItem("sessionToken")&&void 0===localStorage.getItem("sessionToken")||(localStorage.removeItem("sessionToken"),location.replace("/")),location.replace("/"))}catch(e){console.error("An error occurred:",e),""===localStorage.getItem("sessionToken")&&null===localStorage.getItem("sessionToken")&&void 0===localStorage.getItem("sessionToken")||(localStorage.removeItem("sessionToken"),location.replace("/")),location.replace("/")}location.protocol,location.host;function n(e){let t=null;if(document.cookie&&""!==document.cookie){const o=document.cookie.split(";");for(let n=0;n<o.length;n++){const i=o[n].trim();if(i.substring(0,e.length+1)===e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}$.ajaxSetup({beforeSend:function(e,t){/^http:.*/.test(t.url)||/^https:.*/.test(t.url)||e.setRequestHeader("X-CSRFToken",n("csrftoken"))},headers:{"X-CSRFToken":n("csrftoken"),Authorization:"Token "+t}}),$(document).ready((function(){$(".loader").toggleClass("d-block"),$(".item_edit").off("click").on("click",(function(){const e=$(this).closest(".list_item_acc");[e.find(".item_edit"),e.find(".done_item_sign"),e.find(".form_control_item_editing"),e.find(".item_name")].map((e=>{e.toggleClass("d-none")}))})),$(".done_item_sign").off("click").on("click",(function(){$(".loader").toggleClass("d-block");const e=$(this).closest(".list_item_acc"),t=e.find(".form_control_item_editing").val().trim(),o={id:parseInt($(this).closest(".list_item_acc").data("id")),account_name:t};$.ajax({type:"POST",url:HOST+"/api/refactor_account/",data:JSON.stringify(o),contentType:"application/json; charset=utf-8",success:function(o){if(1==o.success){$(".loader").toggleClass("d-block"),e.find(".item_name").text(t);[e.find(".item_edit"),e.find(".done_item_sign"),e.find(".form_control_item_editing"),e.find(".item_name")].map((e=>{e.toggleClass("d-none")}))}else if(0==o.success){alert("Пользователь уже существует или было задано пустое значение"),e.find(".form_control_item_editing").val(""),$(".loader").toggleClass("d-block");[e.find(".item_edit"),e.find(".done_item_sign"),e.find(".form_control_item_editing"),e.find(".item_name")].map((e=>{e.toggleClass("d-none")}))}},error:function(t,o,n){console.log(t,o,n),alert("Что-то пошло не так!"),$(".loader").toggleClass("d-block"),e.find(".form_control_item_editing").val("");[e.find(".item_edit"),e.find(".done_item_sign"),e.find(".form_control_item_editing"),e.find(".item_name")].map((e=>{e.toggleClass("d-none")}))}})})),$(".item_delete").off("click").on("click",(function(){$(".loader").toggleClass("d-block");const e=$(this).closest(".list_item_acc"),t=e.find(".item_name").text(),o={id:parseInt(e.data("id")),account_name:t};$.ajax({type:"POST",url:HOST+"/api/delete_account/",data:o,success:function(t){1==t.success?(e.remove(),$(".loader").toggleClass("d-block"),location.reload()):0==t.success&&($(".loader").toggleClass("d-block"),alert("Пользователь не удален:("))},error:function(t,o,n){console.log(t,o,n),alert("Что-то пошло не так!"),$(".loader").toggleClass("d-block"),e.find(".form_control_item_editing").val("");[e.find(".item_edit"),e.find(".done_item_sign"),e.find(".form_control_item_editing"),e.find(".item_name")].map((e=>{e.toggleClass("d-none")}))}})})),$(".add_account").off("click").on("click",(function(){$(".modal_add_account").toggleClass("d-block"),$(".add_account_to_list").off("click").on("click",(function(){const e=$(".account_push").val().trim();$(".loader").toggleClass("d-block");const t={account_name:e};$.ajax({type:"POST",url:HOST+"/api/add_account/",data:t,success:function(e){const t=$(".accounts_list"),o=`<div class="list_item_acc" data-id="${e.id}"><div class="name_row d-flex"><div class="static_signature">Имя: </div> <div class="item_name ml-1">${e.account_name}</div></div><input class="form_control_item_editing d-none" value=""><div class="item_control_container"><div class="item_delete item_control"></div><div class="item_edit item_control"></div><div class="done_item_sign d-none"></div></div></div>`;t.append(o),location.reload()},error:function(e,t,o){console.log(e,t,o),"account with this account name already exists."==e.responseJSON.account_name[0]?($(".add_account_to_list").text("Пользователь уже существует!"),setTimeout((function(){$(".add_account_to_list").text("Добавить")}),2e3),$(".loader").toggleClass("d-block")):"This field may not be blank."==e.responseJSON.account_name[0]?($(".add_account_to_list").text("Имя Аккаунта не может быть пустым"),setTimeout((function(){$(".add_account_to_list").text("Добавить")}),2e3),$(".loader").toggleClass("d-block")):(alert("Что-то пошло не так!"),$(".loader").toggleClass("d-block"))}})}))})),$('[data-content="closeX"]').off("click").on("click",(function(){$(this).closest(".modal").toggleClass("d-block")}))}))}function getCookie(e){let t=null;if(document.cookie&&""!==document.cookie){const o=document.cookie.split(";");for(let n=0;n<o.length;n++){const i=o[n].trim();if(i.substring(0,e.length+1)===e+"="){t=decodeURIComponent(i.substring(e.length+1));break}}}return t}const sessionToken=localStorage.getItem("sessionToken");gatherData(HOST+"/api/get_accounts/",sessionToken);